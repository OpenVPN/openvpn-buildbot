# -*- python -*-
# ex: set filetype=python:
def openvpnAddClangFormatStepsToBuildFactory(factory, shell_env=None):
    if shell_env is None:
        shell_env = {}

    factory.addStep(
        steps.Git(
            repourl=util.Interpolate("%(prop:repository)s"),
            mode="full",
            name="clone",
            description="cloning",
            descriptionDone="clone",
        )
    )

    factory.addStep(
        steps.ShellCommand(
            command="pre-commit run -a || true",
            name="Run clang-format",
            description="formatting",
            descriptionDone="format",
            env=shell_env,
        )
    )

    factory.addStep(
        steps.ShellCommand(
            command="git diff --exit-code",
            name="Check for changes",
            description="checking",
            descriptionDone="check",
            env=shell_env,
        )
    )

    return factory
